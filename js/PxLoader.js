!function(t){function e(t){t=t||{},this.settings=t,null==t.statusInterval&&(t.statusInterval=5e3),null==t.loggingDelay&&(t.loggingDelay=2e4),null==t.noProgressTimeout&&(t.noProgressTimeout=1/0);var e,s=[],n=[],o=Date.now(),a={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},i=function(t){return null==t?[]:Array.isArray(t)?t:[t]};this.add=function(t){t.tags=new r(t.tags),null==t.priority&&(t.priority=1/0),s.push({resource:t,status:a.QUEUED})},this.addProgressListener=function(t,e){n.push({callback:t,tags:new r(e)})},this.addCompletionListener=function(t,e){n.push({tags:new r(e),callback:function(e){e.completedCount===e.totalCount&&t(e)}})};var u=function(t){t=i(t);var e=function(e){for(var r=e.resource,s=1/0,n=0;n<r.tags.length;n++)for(var o=0;o<Math.min(t.length,s)&&!(r.tags.all[n]===t[o]&&s>o&&(s=o,0===s))&&0!==s;o++);return s};return function(t,r){var s=e(t),n=e(r);return n>s?-1:s>n?1:t.priority<r.priority?-1:t.priority>r.priority?1:0}};this.start=function(t){e=Date.now();var r=u(t);s.sort(r);for(var n=0,o=s.length;o>n;n++){var i=s[n];i.status=a.WAITING,i.resource.start(this)}setTimeout(l,100)};var l=function(){for(var e=!1,r=Date.now()-o,n=r>=t.noProgressTimeout,i=r>=t.loggingDelay,u=0,c=s.length;c>u;u++){var h=s[u];h.status===a.WAITING&&(h.resource.checkStatus&&h.resource.checkStatus(),h.status===a.WAITING&&(n?h.resource.onTimeout():e=!0))}i&&e&&g(),e&&setTimeout(l,t.statusInterval)};this.isBusy=function(){for(var t=0,e=s.length;e>t;t++)if(s[t].status===a.QUEUED||s[t].status===a.WAITING)return!0;return!1};var c=function(t,e){var r,i,u,l,c,g=null;for(r=0,i=s.length;i>r;r++)if(s[r].resource===t){g=s[r];break}if(null!=g&&g.status===a.WAITING)for(g.status=e,o=Date.now(),u=t.tags.length,r=0,i=n.length;i>r;r++)l=n[r],c=0===l.tags.length?!0:t.tags.intersects(l.tags),c&&h(g,l)};this.onLoad=function(t){c(t,a.LOADED)},this.onError=function(t){c(t,a.ERROR)},this.onTimeout=function(t){c(t,a.TIMEOUT)};var h=function(t,e){var r,n,o,i,u=0,l=0;for(r=0,n=s.length;n>r;r++)o=s[r],i=!1,i=0===e.tags.length?!0:o.resource.tags.intersects(e.tags),i&&(l++,(o.status===a.LOADED||o.status===a.ERROR||o.status===a.TIMEOUT)&&u++);e.callback({resource:t.resource,loaded:t.status===a.LOADED,error:t.status===a.ERROR,timeout:t.status===a.TIMEOUT,completedCount:u,totalCount:l})},g=this.log=function(t){if(window.console){var r=Math.round((Date.now()-e)/1e3);window.console.log("PxLoader elapsed: "+r+" sec");for(var n=0,o=s.length;o>n;n++){var i=s[n];if(t||i.status===a.WAITING){var u="PxLoader: #"+n+" "+i.resource.getName();switch(i.status){case a.QUEUED:u+=" (Not Started)";break;case a.WAITING:u+=" (Waiting)";break;case a.LOADED:u+=" (Loaded)";break;case a.ERROR:u+=" (Error)";break;case a.TIMEOUT:u+=" (Timeout)"}i.resource.tags.length>0&&(u+=" Tags: ["+i.resource.tags.all.join(",")+"]"),window.console.log(u)}}}}}function r(t){if(this.all=[],this.first=null,this.length=0,this.lookup={},t){if(Array.isArray(t))this.all=t.slice(0);else if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&this.all.push(e);else this.all.push(t);this.length=this.all.length,this.length>0&&(this.first=this.all[0]);for(var r=0;r<this.length;r++)this.lookup[this.all[r]]=!0}}r.prototype.intersects=function(t){if(0===this.length||0===t.length)return!1;if(1===this.length&&1===t.length)return this.first===t.first;if(t.length<this.length)return t.intersects(this);for(var e in this.lookup)if(t.lookup[e])return!0;return!1},"function"==typeof define&&define.amd&&define("PxLoader",[],function(){return e}),"undefined"!=typeof module&&module.exports?module.exports=e:t.PxLoader=e}(this),Date.now||(Date.now=function(){return(new Date).getTime()}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});